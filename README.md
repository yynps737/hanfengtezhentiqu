# ç„Šç¼ç‰¹å¾æå–ç ”å‘å¹³å°

## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº OpenCASCADE (OCCT) çš„ç„Šç¼ç‰¹å¾è‡ªåŠ¨æå–ç®—æ³•ç ”å‘å¹³å°ï¼Œç”¨äºéªŒè¯ä» STEP æ¨¡å‹ä¸­è‡ªåŠ¨è¯†åˆ«ç„Šç¼çš„å¯è¡Œæ€§ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”§ **STEPæ–‡ä»¶è§£æ**ï¼šæ”¯æŒæ ‡å‡†STEPæ ¼å¼çš„3Dæ¨¡å‹å¯¼å…¥
- ğŸ” **è‡ªåŠ¨ç‰¹å¾è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«è§’ç„Šç¼ã€å¯¹æ¥ç„Šç¼ç­‰å¤šç§ç„Šç¼ç±»å‹
- ğŸ“Š **å‚æ•°å¯è°ƒ**ï¼šæ”¯æŒè°ƒæ•´è¯†åˆ«ç®—æ³•çš„å„é¡¹å‚æ•°
- ğŸ¨ **3Då¯è§†åŒ–**ï¼šåŸºäºThree.jsçš„3Dæ¨¡å‹æ˜¾ç¤ºå’Œç„Šç¼é«˜äº®
- ğŸ’¾ **ç»“æœå¯¼å‡º**ï¼šæ”¯æŒJSONå’ŒCSVæ ¼å¼çš„ç»“æœå¯¼å‡º

## ç›®å½•ç»“æ„

```
weld_research/
â”œâ”€â”€ core/               # æ ¸å¿ƒç®—æ³•æ¨¡å—
â”‚   â”œâ”€â”€ step_loader.py      # STEPæ–‡ä»¶åŠ è½½
â”‚   â”œâ”€â”€ topology_analyzer.py # æ‹“æ‰‘åˆ†æ
â”‚   â”œâ”€â”€ geometry_calculator.py # å‡ ä½•è®¡ç®—
â”‚   â””â”€â”€ weld_detector.py    # ç„Šç¼æ£€æµ‹
â”œâ”€â”€ api/                # Flask APIåç«¯
â”‚   â””â”€â”€ app.py              # APIæ¥å£å®ç°
â”œâ”€â”€ web/                # å‰ç«¯ç•Œé¢
â”‚   â”œâ”€â”€ index.html          # ä¸»é¡µé¢
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ css/            # æ ·å¼æ–‡ä»¶
â”‚       â””â”€â”€ js/             # JavaScriptè„šæœ¬
â”œâ”€â”€ test_data/          # æµ‹è¯•STEPæ–‡ä»¶
â”œâ”€â”€ requirements.txt    # Pythonä¾èµ–
â”œâ”€â”€ run.py             # å¯åŠ¨è„šæœ¬
â””â”€â”€ README.md          # æœ¬æ–‡æ¡£
```

## å®‰è£…æŒ‡å—

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.10+
- Conda (æ¨è) æˆ– pip

### 2. å®‰è£…PythonOCC

ä½¿ç”¨ conda å®‰è£…ï¼ˆæ¨èï¼‰ï¼š
```bash
conda create -n weld_research python=3.10
conda activate weld_research
conda install -c conda-forge pythonocc-core
```

### 3. ä½¿ç”¨environment.ymlå®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆæ¨èï¼‰

```bash
conda env create -f environment.yml
conda activate weld_research
```

æˆ–è€…æ‰‹åŠ¨å®‰è£…ï¼š
```bash
conda install -c conda-forge pythonocc-core
pip install flask flask-cors numpy werkzeug
```

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡

```bash
python run.py
```

æˆ–ç›´æ¥è¿è¡Œï¼š
```bash
cd weld_research
python api/app.py
```

### 2. è®¿é—®ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5000

### 3. ä½¿ç”¨æµç¨‹

1. **ä¸Šä¼ æ–‡ä»¶**ï¼šé€‰æ‹©æˆ–æ‹–æ‹½STEPæ–‡ä»¶åˆ°ä¸Šä¼ åŒº
2. **è°ƒæ•´å‚æ•°**ï¼šæ ¹æ®éœ€è¦è°ƒæ•´æ£€æµ‹å‚æ•°
3. **å¼€å§‹åˆ†æ**ï¼šç‚¹å‡»"å¼€å§‹åˆ†æ"æŒ‰é’®
4. **æŸ¥çœ‹ç»“æœ**ï¼šåœ¨å³ä¾§é¢æ¿æŸ¥çœ‹æ£€æµ‹ç»“æœ
5. **å¯¼å‡ºæ•°æ®**ï¼šé€‰æ‹©JSONæˆ–CSVæ ¼å¼å¯¼å‡º

## APIæ¥å£æ–‡æ¡£

### ä¸Šä¼ æ–‡ä»¶
```
POST /api/upload
Content-Type: multipart/form-data
Body: file (STEPæ–‡ä»¶)
```

### åˆ†ææ¨¡å‹
```
POST /api/analyze
Content-Type: application/json
Body: {
    "parameters": {
        "fillet": {"min_angle": 60, "max_angle": 120},
        "butt": {"min_angle": 150, "max_angle": 180}
    }
}
```

### è·å–å‚æ•°
```
GET /api/parameters
```

### å¯¼å‡ºç»“æœ
```
GET /api/export?format=json
GET /api/export?format=csv
```

## ç„Šç¼ç±»å‹è¯´æ˜

### è§’ç„Šç¼ (Fillet Weld)
- è§’åº¦èŒƒå›´ï¼š60Â° - 120Â°
- ä¸¤ä¸ªé¢é€šè¿‡ä¸€æ¡è¾¹è¿æ¥
- é€‚ç”¨äºTå‹è¿æ¥

### å¯¹æ¥ç„Šç¼ (Butt Weld)
- è§’åº¦èŒƒå›´ï¼š150Â° - 180Â°
- ä¸¤ä¸ªé¢è¿‘ä¼¼å¹³è¡Œ
- é€‚ç”¨äºæ¿æå¯¹æ¥

### æ­æ¥ç„Šç¼ (Lap Weld)
- è§’åº¦èŒƒå›´ï¼š< 30Â°
- ä¸¤ä¸ªé¢é‡å 
- é€‚ç”¨äºæ­æ¥è¿æ¥

## æ ¸å¿ƒç®—æ³•è¯´æ˜

1. **æ‹“æ‰‘åˆ†æ**ï¼šä½¿ç”¨ `TopExp::MapShapesAndAncestors` æ„å»ºè¾¹-é¢æ˜ å°„å…³ç³»
2. **å‡ ä½•è®¡ç®—**ï¼šè®¡ç®—äºŒé¢è§’ã€è¾¹é•¿åº¦ç­‰å‡ ä½•å±æ€§
3. **ç‰¹å¾åŒ¹é…**ï¼šæ ¹æ®å‡ ä½•ç‰¹å¾åŒ¹é…ç„Šç¼æ¨¡æ¿
4. **ç½®ä¿¡åº¦è¯„ä¼°**ï¼šåŸºäºç‰¹å¾ç¬¦åˆç¨‹åº¦è®¡ç®—è¯†åˆ«ç½®ä¿¡åº¦

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ç„Šç¼ç±»å‹

åœ¨ `core/weld_detector.py` ä¸­ï¼š

```python
# 1. åœ¨ WeldType æšä¸¾ä¸­æ·»åŠ æ–°ç±»å‹
class WeldType(Enum):
    NEW_TYPE = "new_type"

# 2. åœ¨ __init__ ä¸­æ·»åŠ å‚æ•°
self.params['new_type'] = {
    'min_angle': 45,
    'max_angle': 90,
    'min_length': 10.0
}

# 3. åœ¨ _classify_weld_type ä¸­æ·»åŠ åˆ¤å®šé€»è¾‘
```

### è‡ªå®šä¹‰å‡ ä½•è®¡ç®—

åœ¨ `core/geometry_calculator.py` ä¸­æ·»åŠ æ–°çš„é™æ€æ–¹æ³•ï¼š

```python
@staticmethod
def calculate_custom_feature(edge, face1, face2):
    """è‡ªå®šä¹‰ç‰¹å¾è®¡ç®—"""
    # å®ç°è®¡ç®—é€»è¾‘
    return feature_value
```

## å¸¸è§é—®é¢˜

### Q: PythonOCCå®‰è£…å¤±è´¥
A: å»ºè®®ä½¿ç”¨condaå®‰è£…ï¼Œç¡®ä¿Pythonç‰ˆæœ¬ä¸º3.10

### Q: æ–‡ä»¶ä¸Šä¼ å¤±è´¥
A: æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦ä¸ºSTEP/STPï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡100MB

### Q: åˆ†æç»“æœä¸å‡†ç¡®
A: å°è¯•è°ƒæ•´æ£€æµ‹å‚æ•°ï¼Œç‰¹åˆ«æ˜¯è§’åº¦èŒƒå›´å’Œæœ€å°é•¿åº¦

## åç»­è®¡åˆ’

- [ ] æ·»åŠ æ›´å¤šç„Šç¼ç±»å‹è¯†åˆ«
- [ ] æ”¯æŒæ‰¹é‡æ–‡ä»¶å¤„ç†
- [ ] å¢å¼º3Då¯è§†åŒ–ï¼ˆæ˜¾ç¤ºå®é™…æ¨¡å‹ï¼‰
- [ ] æ·»åŠ ç„Šæ¥è·¯å¾„ä¼˜åŒ–ç®—æ³•
- [ ] é›†æˆæœºå™¨å­¦ä¹ ä¼˜åŒ–è¯†åˆ«

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›ç ”å‘ä½¿ç”¨

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚